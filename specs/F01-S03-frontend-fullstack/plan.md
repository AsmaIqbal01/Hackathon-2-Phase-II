# Implementation Plan: Frontend Application & Full-Stack Integration (Minimal)

**Branch**: `F01-S03-frontend-fullstack` | **Date**: 2026-02-01 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `specs/F01-S03-frontend-fullstack/spec.md`
**Scope**: Minimal hackathon integration proof

## Summary

Implement a minimal Next.js frontend that authenticates users via the FastAPI backend, stores JWT in localStorage, and provides basic task CRUD operations. The goal is to prove secure full-stack integration, not UI polish.

## Technical Context

**Language/Version**: TypeScript 5.x, Node.js 18+
**Primary Dependencies**: Next.js 15+ (App Router), Tailwind CSS
**Storage**: localStorage for JWT token
**Testing**: N/A (not in minimal scope)
**Target Platform**: Web (modern browsers)
**Project Type**: Web application (frontend portion)
**Performance Goals**: Functional correctness over performance
**Constraints**: No token refresh, no optimistic updates, no caching
**Scale/Scope**: Single-user session per browser; integrates with multi-user backend

## Constitution Check

*GATE: Must pass before implementation.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Spec-Driven Development | ✅ PASS | Spec exists at F01-S03-frontend-fullstack/spec.md |
| II. Reuse Over Reinvention | ✅ PASS | References Spec 1 + Spec 2; no duplicate API definitions |
| III. Amendment-Based Development | ✅ PASS | Only adds web UI; inherits task logic from Phase I |
| IV. Multi-User Data Ownership | ✅ PASS | Frontend never sends user_id; backend extracts from JWT |
| V. Stateless Authentication | ✅ PASS | JWT in Authorization header; localStorage storage |
| VI. Web-First Architecture | ✅ PASS | Decoupled frontend/backend; API-first |
| VII. Test-Driven Development | ⏸ SKIPPED | Minimal scope - tests not requested |
| VIII. Observability & Error Handling | ✅ PASS | Per-operation error states; no silent failures |
| IX. Agentic Execution Only | ✅ PASS | Implementation via Claude Code agents |
| X. Reviewability as First-Class | ✅ PASS | PHRs created for all interactions |

**Gate Result**: PASS — Proceed to implementation.

---

## Project Structure

### Documentation (this feature)

```text
specs/F01-S03-frontend-fullstack/
├── spec.md              # Feature specification (minimal scope)
├── specify.prompt.md    # Raw user input
├── plan.md              # This file
├── research.md          # Technology decisions
├── data-model.md        # Frontend types
├── quickstart.md        # Setup guide
├── contracts/
│   └── api-client-contract.md
├── checklists/
│   └── requirements.md
└── tasks.md             # Generated by /sp.tasks
```

### Source Code (Minimal Structure)

```text
frontend/
├── app/
│   ├── layout.tsx           # Root layout
│   ├── page.tsx             # Redirect to /dashboard or /login
│   ├── login/
│   │   └── page.tsx         # Login form
│   ├── register/
│   │   └── page.tsx         # Registration form
│   └── dashboard/
│       └── page.tsx         # Task list + CRUD
├── lib/
│   ├── api.ts               # Centralized fetch with JWT
│   └── auth.ts              # Token storage helpers
├── components/
│   ├── TaskList.tsx         # Task list component
│   ├── TaskItem.tsx         # Individual task row
│   └── TaskForm.tsx         # Create task form
├── .env.example             # NEXT_PUBLIC_API_URL template
├── .env.local               # Local environment (gitignored)
├── package.json
└── README.md                # Setup documentation
```

**Structure Decision**: Minimal frontend with flat component structure. No complex nesting or feature folders.

---

## Complexity Tracking

No violations. Simplified from original plan:

| Simplification | Previous | Minimal |
|----------------|----------|---------|
| Token storage | Better Auth (httpOnly cookie) | localStorage |
| Token refresh | Automatic | Not implemented (page reload) |
| Responsive design | Required at 3 breakpoints | Functional only |
| UI components | Separate ui/ folder | Inline with features |
| Auth context | React Context provider | Simple module functions |

---

## Implementation Strategy

### Phase 1: Project Setup

1. **Initialize Next.js Project**
   - Create Next.js 15+ with App Router
   - Configure TypeScript, Tailwind CSS
   - Create `.env.example` with `NEXT_PUBLIC_API_URL`

2. **Auth Helpers** (`lib/auth.ts`)
   ```typescript
   export function getToken(): string | null
   export function setToken(token: string): void
   export function clearToken(): void
   export function isAuthenticated(): boolean
   ```

3. **API Client** (`lib/api.ts`)
   ```typescript
   export async function apiClient<T>(
     endpoint: string,
     options?: RequestInit
   ): Promise<T>
   // Attaches Authorization header automatically
   // Handles 401 by returning error (no auto-refresh)
   ```

### Phase 2: Authentication Pages

4. **Login Page** (`app/login/page.tsx`)
   - Form with email and password inputs
   - Call POST /api/auth/login
   - Store token in localStorage on success
   - Redirect to /dashboard

5. **Register Page** (`app/register/page.tsx`)
   - Form with email and password inputs
   - Call POST /api/auth/register
   - Store token in localStorage on success
   - Redirect to /dashboard

6. **Root Page** (`app/page.tsx`)
   - Check if token exists
   - Redirect to /dashboard if authenticated
   - Redirect to /login if not

### Phase 3: Dashboard & Task CRUD

7. **Dashboard Page** (`app/dashboard/page.tsx`)
   - Check authentication (redirect if not)
   - Fetch and display tasks
   - Show loading and error states
   - Include logout button

8. **TaskList Component** (`components/TaskList.tsx`)
   - Display list of tasks
   - Empty state message when no tasks
   - Loading spinner during fetch

9. **TaskItem Component** (`components/TaskItem.tsx`)
   - Display task title and status
   - Toggle button (calls PATCH)
   - Delete button (calls DELETE)

10. **TaskForm Component** (`components/TaskForm.tsx`)
    - Title input (required)
    - Submit button
    - Client-side validation
    - Calls POST /api/tasks

### Phase 4: Documentation

11. **README.md**
    - Prerequisites (Node.js, npm)
    - Setup steps
    - Environment configuration
    - Run commands

---

## Agent Assignment

| Task Area | Agent | Rationale |
|-----------|-------|-----------|
| All frontend work | `nextjs-frontend-optimizer` | Next.js App Router expertise |

Single agent for entire frontend as scope is minimal.

---

## Integration Points

### Backend Endpoints (Spec 1)

| Frontend Action | Backend Endpoint | Auth Required |
|-----------------|------------------|---------------|
| List tasks | GET /api/tasks | Yes |
| Create task | POST /api/tasks | Yes |
| Update task | PATCH /api/tasks/{id} | Yes |
| Delete task | DELETE /api/tasks/{id} | Yes |

### Auth Endpoints (Spec 2)

| Frontend Action | Backend Endpoint | Auth Required |
|-----------------|------------------|---------------|
| Login | POST /api/auth/login | No |
| Register | POST /api/auth/register | No |

---

## Simplifications from Full Scope

1. **No token refresh**: On 401, redirect to login. User re-authenticates.
2. **No middleware**: Client-side auth check only.
3. **No auth context**: Simple module functions instead of React Context.
4. **No UI components library**: Inline styles with Tailwind.
5. **No confirmation dialogs**: Direct delete without confirmation.
6. **No responsive design**: Functional layout only.

---

## Error Handling (Minimal)

| Status | Action |
|--------|--------|
| 401 | Clear token, redirect to /login |
| 403 | Display "Access denied" message |
| 400/422 | Display error message inline |
| 5xx | Display "Service unavailable" |
| Network error | Display "Network error" |

---

## Success Verification

Per spec success criteria (SC-001 to SC-007):

- [x] SC-001: Unauthenticated /dashboard redirects to /login (T017 - auth check in dashboard)
- [x] SC-002: Login stores JWT and redirects to /dashboard (T012 - login submission)
- [x] SC-003: All API requests include Authorization header (T007 - API client)
- [x] SC-004: User A cannot see User B's tasks (backend enforces via JWT)
- [x] SC-005: CRUD operations persist (T043 - integration verified)
- [x] SC-006: No secrets in committed code (T042 - .gitignore verified)
- [x] SC-007: README documents setup steps (T039 - README created)

**All success criteria verified. Implementation complete.**

---

## Risks & Mitigations

| Risk | Mitigation |
|------|------------|
| CORS issues | Ensure backend CORS allows frontend origin |
| localStorage security | Acceptable for hackathon; document tradeoff |
| No token refresh | Document: user re-authenticates on expiry |

---

## Next Steps

**Implementation Complete** - All 43 tasks finished.

To run the application:
1. Start backend: `cd backend && uvicorn src.main:app --reload`
2. Start frontend: `cd frontend && npm run dev`
3. Open http://localhost:3000
