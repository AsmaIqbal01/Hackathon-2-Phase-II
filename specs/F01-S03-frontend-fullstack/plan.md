# Implementation Plan: Frontend Application & Full-Stack Integration

**Branch**: `F01-S03-frontend-fullstack` | **Date**: 2026-01-30 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `specs/F01-S03-frontend-fullstack/spec.md`

## Summary

Implement a Next.js 16+ frontend that authenticates users via Better Auth, consumes the FastAPI backend (Spec 1), and enforces JWT-based authorization. The frontend provides CRUD operations for tasks scoped to the authenticated user without ever sending `user_id` explicitly.

## Technical Context

**Language/Version**: TypeScript 5.x, Node.js 18+
**Primary Dependencies**: Next.js 16+ (App Router), Better Auth, Tailwind CSS
**Storage**: N/A (backend handles persistence via Spec 1)
**Testing**: Jest + React Testing Library (if tests requested)
**Target Platform**: Web (modern browsers)
**Project Type**: Web application (frontend portion)
**Performance Goals**: Dashboard load <2s, redirect <100ms
**Constraints**: No optimistic updates, no offline support, no caching
**Scale/Scope**: Single-user session per browser; integrates with multi-user backend

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Spec-Driven Development | ✅ PASS | Spec exists at F01-S03-frontend-fullstack/spec.md |
| II. Reuse Over Reinvention | ✅ PASS | References Spec 1 + Spec 2; no duplicate API definitions |
| III. Amendment-Based Development | ✅ PASS | Only adds web UI; inherits task logic from Phase I |
| IV. Multi-User Data Ownership | ✅ PASS | Frontend never sends user_id; backend extracts from JWT |
| V. Stateless Authentication | ✅ PASS | JWT in Authorization header; no session storage |
| VI. Web-First Architecture | ✅ PASS | Decoupled frontend/backend; API-first |
| VII. Test-Driven Development | ⏸ DEFERRED | Tests not requested; structure supports addition |
| VIII. Observability & Error Handling | ✅ PASS | Per-operation error states; no silent failures |
| IX. Agentic Execution Only | ✅ PASS | Implementation via Claude Code agents |
| X. Reviewability as First-Class | ✅ PASS | PHRs created for all interactions |

**Gate Result**: PASS — Proceed to implementation.

## Project Structure

### Documentation (this feature)

```text
specs/F01-S03-frontend-fullstack/
├── spec.md              # Feature specification
├── plan.md              # This file
├── research.md          # Technology decisions
├── data-model.md        # Frontend types
├── quickstart.md        # Setup guide
├── contracts/
│   └── api-client-contract.md
└── tasks.md             # Generated by /sp.tasks
```

### Source Code (repository root)

```text
frontend/
├── app/
│   ├── layout.tsx           # Root layout + AuthProvider
│   ├── page.tsx             # Landing redirect logic
│   ├── login/
│   │   └── page.tsx         # Login form (US5)
│   ├── signup/
│   │   └── page.tsx         # Registration form (US5)
│   └── dashboard/
│       ├── layout.tsx       # Protected layout wrapper
│       └── page.tsx         # Task list + CRUD (US1-4)
├── components/
│   ├── auth/
│   │   ├── LoginForm.tsx    # Login UI
│   │   └── SignupForm.tsx   # Signup UI
│   ├── tasks/
│   │   ├── TaskList.tsx     # Task list container
│   │   ├── TaskItem.tsx     # Single task row
│   │   ├── TaskForm.tsx     # Create/edit form
│   │   └── DeleteConfirm.tsx # Delete confirmation modal
│   └── ui/
│       ├── Button.tsx       # Reusable button
│       ├── Input.tsx        # Reusable input
│       ├── Modal.tsx        # Reusable modal
│       └── Spinner.tsx      # Loading indicator
├── lib/
│   ├── api-client.ts        # Centralized fetch + JWT
│   ├── auth-context.tsx     # Auth state provider
│   └── types.ts             # TypeScript interfaces
├── middleware.ts            # Route protection
├── .env.example             # Environment template
└── package.json
```

**Structure Decision**: Web application structure with Next.js App Router. Frontend-only; backend exists separately (Spec 1).

## Complexity Tracking

No violations detected. Single frontend project with standard patterns.

---

## Implementation Strategy

### Phase 1: Foundation (FR-001 to FR-007)

1. **Project Setup**
   - Initialize Next.js 16+ with App Router
   - Configure TypeScript, Tailwind CSS
   - Create `.env.example` with `NEXT_PUBLIC_API_URL`

2. **API Client Module** (FR-004 to FR-007)
   - Create `lib/api-client.ts`
   - Implement JWT header injection
   - Implement error handling (401 refresh, 403 display, 5xx generic)

3. **Type Definitions**
   - Create `lib/types.ts` with Task, User, AuthState, ApiError

### Phase 2: Authentication (FR-008 to FR-013, US5, US6, US7)

4. **Auth Context**
   - Create `lib/auth-context.tsx`
   - Implement login, register, logout, refreshToken actions
   - Store access token in memory

5. **Auth Pages**
   - Create `/login/page.tsx` with LoginForm
   - Create `/signup/page.tsx` with SignupForm
   - Handle 401, 409, 429 responses

6. **Route Protection** (FR-001 to FR-003)
   - Create `middleware.ts` for server-side redirect
   - Create protected layout at `/dashboard/layout.tsx`

### Phase 3: Task CRUD (FR-014 to FR-017, US1-4)

7. **Task List** (US1)
   - Create `TaskList.tsx` component
   - Fetch tasks on mount via API client
   - Display loading, error, empty states

8. **Task Create** (US2)
   - Create `TaskForm.tsx` for creation
   - Client-side title validation
   - POST to `/api/tasks`

9. **Task Update** (US3)
   - Extend `TaskForm.tsx` for editing
   - PATCH partial updates
   - Inline error display

10. **Task Delete** (US4)
    - Create `DeleteConfirm.tsx` modal
    - Confirmation before DELETE
    - Remove from list on success

### Phase 4: UI/UX Polish (FR-027 to FR-030)

11. **Responsive Design**
    - Apply Tailwind responsive classes
    - Test at 320px, 768px, 1024px

12. **Loading & Error States**
    - Add Spinner component
    - Ensure all async ops show loading
    - Inline validation errors

---

## Agent Assignment

| Task Area | Agent | Rationale |
|-----------|-------|-----------|
| Project setup, pages, routing | `nextjs-frontend-optimizer` | Next.js App Router expertise |
| API client implementation | `nextjs-frontend-optimizer` | Frontend HTTP patterns |
| Auth context + forms | `nextjs-frontend-optimizer` | React state management |
| Task components | `nextjs-frontend-optimizer` | Component architecture |
| Responsive design | `nextjs-frontend-optimizer` | Tailwind CSS optimization |

All implementation via `nextjs-frontend-optimizer` agent as this is frontend-only work.

---

## Integration Points

### Backend (Spec 1)

| Frontend Action | Backend Endpoint | Contract Reference |
|-----------------|------------------|--------------------|
| List tasks | GET /api/tasks | Spec 1 FR-011 |
| Create task | POST /api/tasks | Spec 1 FR-005 |
| Update task | PATCH /api/tasks/{id} | Spec 1 FR-016 |
| Delete task | DELETE /api/tasks/{id} | Spec 1 FR-020 |

### Auth (Spec 2)

| Frontend Action | Backend Endpoint | Contract Reference |
|-----------------|------------------|--------------------|
| Login | POST /api/auth/login | Spec 2 FR-026 |
| Register | POST /api/auth/register | Spec 2 FR-025 |
| Logout | POST /api/auth/logout | Spec 2 FR-027 |
| Refresh | POST /api/auth/refresh | Spec 2 FR-028 |

---

## Risks & Mitigations

| Risk | Mitigation |
|------|------------|
| Better Auth Next.js 16 compatibility | Pin version; test early |
| Token refresh race condition | Queue concurrent requests during refresh |
| Middleware cold start latency | Monitor; add client-side fallback if needed |

---

## Success Verification

Per spec success criteria:

- [ ] SC-001: Unauthenticated `/dashboard` redirects to `/login` within 100ms
- [ ] SC-002: Authenticated user sees tasks within 2 seconds
- [ ] SC-003: CRUD operations reflect backend state accurately
- [ ] SC-004: 401 triggers automatic token refresh transparently
- [ ] SC-005: 403 displays access denied without redirect
- [ ] SC-006: Forms validate required fields before submission
- [ ] SC-007: Renders correctly at 320px, 768px, 1024px
- [ ] SC-008: No `user_id` parameter in any request

---

## Next Steps

Run `/sp.tasks` to generate atomic implementation tasks from this plan.
